#!/usr/bin/env bash
# SELIS - Space Engineers Linux Ingame Scripting
# Main dispatcher script for git-style subcommands

set -euo pipefail

########################
# SCRIPT SETUP
########################

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
export CONFIG_FILE="${SCRIPT_DIR}/selis.conf"

# Source common functions
source "${SCRIPT_DIR}/lib/common.sh"

########################
# USAGE
########################

show_usage() {
    cat <<EOF
SELIS - Space Engineers Linux Ingame Scripting

Usage: selis <command> [arguments]

Commands:
  create <ProjectName>
      Create a new Space Engineers script project with IntelliSense support.
      Example: selis create MyScript

  export <ProjectFolderName> <IngameScriptName>
      Process and export a script to Space Engineers IngameScripts folder.
      Validates code, strips wrapper, minifies, and deploys to game.
      Example: selis export MyScript MyScript

  remove <ProjectName>
      Remove a project from both the solution file and filesystem.
      Requires confirmation prompt.
      Example: selis remove MyScript

  help
      Show this help message.

Configuration:
  Edit selis.conf to set your Steam and Space Engineers paths.

For more information, see README.md
EOF
}

########################
# MAIN DISPATCHER
########################

# Check if any arguments provided
if [ "$#" -eq 0 ]; then
    show_usage
    exit 1
fi

COMMAND="$1"
shift

case "$COMMAND" in
    create)
        source "${SCRIPT_DIR}/lib/create.sh"
        cmd_create "$@"
        ;;
    export)
        source "${SCRIPT_DIR}/lib/export.sh"
        cmd_export "$@"
        ;;
    remove)
        source "${SCRIPT_DIR}/lib/remove.sh"
        cmd_remove "$@"
        ;;
    help|--help|-h)
        show_usage
        ;;
    *)
        echo "ERROR: Unknown command: $COMMAND"
        echo
        show_usage
        exit 1
        ;;
esac
