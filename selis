#!/usr/bin/env bash
# SELIS - Space Engineers Linux Ingame Scripting
# Main dispatcher script for git-style subcommands

set -euo pipefail

########################
# SCRIPT SETUP
########################

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
export CONFIG_FILE="${SCRIPT_DIR}/selis.conf"

# Source common functions
source "${SCRIPT_DIR}/lib/common.sh"

########################
# USAGE
########################

show_usage() {
    cat "${SCRIPT_DIR}/lib/templates/help.txt"
}

########################
# MAIN DISPATCHER
########################

# Check if any arguments provided
if [ "$#" -eq 0 ]; then
    show_usage
    exit 1
fi

COMMAND="$1"
shift

case "$COMMAND" in
    create)
        source "${SCRIPT_DIR}/lib/create.sh"
        cmd_create "$@"
        ;;
    export)
        source "${SCRIPT_DIR}/lib/export.sh"
        cmd_export "$@"
        ;;
    remove)
        source "${SCRIPT_DIR}/lib/remove.sh"
        cmd_remove "$@"
        ;;
    validate)
        source "${SCRIPT_DIR}/lib/validate.sh"
        cmd_validate "$@"
        ;;
    help|--help|-h)
        show_usage
        ;;
    *)
        echo "ERROR: Unknown command: $COMMAND"
        echo
        show_usage
        exit 1
        ;;
esac
